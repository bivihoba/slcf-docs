Использование Grunt
=========

Предполагается, что Grunt - знакомая система сборки.
Если нет, то сначала следует прочитать [официальную документацию](http://gruntjs.com/getting-started).

### Краткий обзор

Все основные таски прокомментированы в основном файле – Gruntfile.js.
Grunt-конфиг для плагинов вынесен из Gruntfile.js в отдельные файлы
(используется [load-grunt-config](https://github.com/firstandthird/load-grunt-config)).
На каждый плагин приходится свой файл, см. папку _grunt/config_.
Остальные, специфичные для проекта SLCF, штуки также можно найти в папке _grunt_.
Помимо конфигурационных файлов там лежит папка _slcf-tools_ с техническими тасками и SLCF-хэлпером,
который используется стандартными плагинами.
Также, в папке _grunt_, по ходу работы сборщика появляется папка _newer-cache_,
содержащая кэш плагина [grunt-newer](https://github.com/tschaub/grunt-newer).

### Grunt-задачи при работе над проектом

Можно выделить два режима работы над проектом: продолжительная работа и точечные исправления.
Каждому режиму соответствуют свои задачи.

При большом количестве правок следует запускать ватчер:

```
$ grunt watch
```

Ватчер отслеживает изменения файлов страниц и изменения файлов стилей разных технологий **в проектных бандлах**,
а также изменения специального бандла __assets. (см. _grunt/config/watch.js_).
Если эти файлы были добавлены или изменены, ватчер запускает соответствующие таски для сборки.

Таски, которые выполняются по событиям ватчера, изменяют только dev-версии конечных файлов.

После того, как работа с кодом завершена и протестирована, можно собирать production-версию конечных файлов.
Для этого можно использовать дефолтную таску Grunt:

```
$ grunt
```

Важным моментом работы сборщика является использование _grunt-newer_ для сборки страниц.
Однако кэш newer-a не всегда может быть актуальным, поскольку не учитывает изменения в шаблонах.
Кроме того из проекта могут удаляться некоторые файлы или страницы,
а значит необходимо удалять и соответствующие конечные файлы в _code_.

Для очистки всех генерируемых файлов следует использовать:

```
$ grunt cleanProject
```

Очистить только часть, например, кэш newer-a,
можно используя таргеты для _clean_ из конфига (см. _grunt/config/clean.js_).

```
$ grunt clean:newerCache
```

Для сборки всего проекта используется:

```
$ grunt buildProject
```

Для точечных правок стилей вместо того, чтобы запускать ватчер,
можно поправить код и запустить пересборку всех стилей:

```
$ grunt buildProjectStyles
```

[Подробнее о сборке стилей](css.md)