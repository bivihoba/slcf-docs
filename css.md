Сборка стилей
=========

Файлы стилей рекомендуется разбивать по БЭМ-сущностям, но поддерживать много файлов вручную неудобно, поэтому в SLCF заложен механизм для сборки стилей. Ключевыми элементами этого механизма являются вспомогательные файлы стилей и правильное именование файлов. Существует 4 технических файла с зарезервированными именами:

- blocks.auto.less
- blocks.auto.used.less
- blocks.deps.less
- blocks.hard.deps.less

_Это файлы для технологии Less, аналогичные имена будут для других стилевых технологий, поддерживаемых в SLCF (про поддержку стилей см. ниже)._

Файлы _blocks.auto.less_ и _blocks.auto.used.less_ генерируются автоматически, _blocks.deps.less_ и _blocks.hard.deps.less_ нужно создавать руками при необходимости. Каждый из этих файлов содержит список импортов.

_blocks.auto.less_ – включает все файлы БЭМ-сущностей бандла + те, что объявлены в _blocks.deps.less_.

_blocks.deps.less_ – содержит подключения зависимостей от внешних бандлов. Это могут быть точечные подключения конкретных БЭМ-сущностей или подключение бандлов как библиотек, в этом случае подключается файл blocks.auto.less внешнего бандла.

Пример:

```
@import "../../../vendors/slcf-nano-core/less.blocks/blocks.auto.less"; // все блоки бандла slcf-nano-core
@import "../../../vendors/slcf-ui-controls/less.blocks/b-select.less"; // один блок бандла slcf-ui-controls
```

Можно было бы ограничиться двумя этими файлами, но тогда из-за лишних деклараций в самом бандле и при подключении внешних библиотек, возникает проблема лишнего кода. Для ее устранения вводится дополнительный этап сборки - проверка на используемость БЭМ-сущностей на страницах бандла. Все подключения в _blocks.auto.less_ сравниваются с перечнем БЭМ-сущностей, которые составляют конечные BEMXML-деревья всех страниц бандла (индекс БЭМ-сущностей для каждой страницы можно найти в папке _page-schemes_ бандла).

В такой проверке есть один минус. При пересечении множества всех деклараций бандла и множества сущностей в BEMXML, из результирующего множества выпадают те сущности, которые в BEMXML не объявлены. Такие сущности могут появляются динамически как  результат выполнения Javascript, или находятся в шаблонах внутри CDATA-областей, или нужно подключить их независимо от текущего состояния страниц. Поскольку таких сущностей на данный момент несопоставимо меньше, чем тех, что составляют BEMXML, то придется вручную "возвращать" их в сборку. Для таких "жестких" зависимостей предназначен файл _blocks.hard.deps.less_.

Все подключения, прошедшие проверку на использование, вместе с объявленными в _blocks.hard.deps.less_, составляют _blocks.auto.used.less_.

В сборке важны еще два момента: 

1. Автоматически подключаются в _blocks.auto.less_ и проходят сравнение только правильно названные файлы.
2. Все импорты в _blocks.auto.less_ и _blocks.auto.used.less_ отсортированы в порядке приоритета БЭМ-модификаторов.

### Схема именования файлов

Для работы сборщика необходимо соблюдать правила именования файлов. В целом имя файла должно соответствовать классической БЭМ-нотации. Имя файла должен начинаться с префикса "b-" за которым следует полное название БЭМ-сущности (также как в BEMXML). Для деклараций модификаторов можно в имени файла опускать значение модификатора. 

Правильные имена файлов:

- b-page.less
- b-section__header.less
- b-button_size.less
- b-form-field_type_text.less

### Приоритеты БЭМ-модификаторов

Приоритет модификаторов задается в _specialBEMModes_ конфига /grunt/slcf-tools/config.js . Если модификатор не включен в конфиг, то он не обладает дополнительным приоритетом.

### Стилевые технологии

Описанная система сборки стилей применима для всех стилевых технологий, поддерживаемых в SLCF ( см. _CSStechnologies_ в конфиге /grunt/slcf-tools/config.js)
